<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Abort Current Inline Script Scriptlet Test</title>
    <link rel="stylesheet" href="../../shared/style.css">
</head>
<body>
    <script src="../../shared/utils.js"></script>
    <p><a href="../index.html">[Scriptlets]</a></p>

    <p>This page verifies that the abort-current-inline-script scriptlet works properly given the <a href="../config/abort-current-inline-script.json">config</a>.</p>

    <script>
        // eslint-disable-next-line no-undef
        test('Abort-current-inline-script scriptlet should abort matching scripts', async () => {
            // Wait a bit for scriptlets to execute
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Reset flags
            window.badScriptExecuted = false;
            window.goodScriptExecuted = false;

            // Create scripts dynamically so the scriptlet can intercept them
            const badScript = document.createElement('script');
            badScript.textContent = `
                const badScript = document.createElement('div');
                window.badScriptExecuted = true;
            `;

            const goodScript = document.createElement('script');  
            goodScript.textContent = `
                const goodElement = document.createElement('span');
                window.goodScriptExecuted = true;
            `;

            // Add scripts to DOM - scriptlet should abort the bad one
            document.body.appendChild(badScript);
            document.body.appendChild(goodScript);
            
            // Wait for scripts to potentially execute
            await new Promise(resolve => setTimeout(resolve, 100));

            return [
                { name: 'Bad script should not execute', result: window.badScriptExecuted, expected: false },
                { name: 'Good script should execute normally', result: window.goodScriptExecuted, expected: true }
            ];
        });

        // eslint-disable-next-line no-undef
        renderResults();
    </script>
</body>
</html> 