<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Remove Node Text Scriptlet Test</title>
    <link rel="stylesheet" href="../../shared/style.css">
</head>
<body>
    <script src="../../shared/utils.js"></script>
    <p><a href="../index.html">[Scriptlets]</a></p>

    <p>This page verifies that the remove-node-text scriptlet works properly given the <a href="../config/remove-node-text.json">config</a>.</p>

    <!-- This script should have its content removed because it contains "badScriptContent" -->
    <script id="badScript">
        window.badScriptRan = true;
        const badScriptContent = 'This script should be removed';
    </script>

    <!-- This script should execute normally -->
    <script id="goodScript">
        window.goodScriptRan = true;
        const goodScriptContent = 'This script should remain';
    </script>

    <script>
        // eslint-disable-next-line no-undef
        test('Remove-node-text scriptlet should remove matching script content', async () => {
            // Wait a bit for scriptlets to execute
            await new Promise(resolve => setTimeout(resolve, 100));

            // Check if the scripts ran (they both should since they execute immediately)
            const badScriptRan = typeof window.badScriptRan !== 'undefined' && window.badScriptRan === true;
            const goodScriptRan = typeof window.goodScriptRan !== 'undefined' && window.goodScriptRan === true;

            // Check if script content was removed from DOM by the scriptlet
            const badScript = document.getElementById('badScript');
            const goodScript = document.getElementById('goodScript');
            
            const badScriptTextRemoved = !badScript.textContent || !badScript.textContent.includes('badScriptContent');
            const goodScriptTextRemains = goodScript.textContent && goodScript.textContent.includes('goodScriptContent');

            return [
                { name: 'Bad script executed before scriptlet could prevent it', result: badScriptRan, expected: true },
                { name: 'Good script should have executed', result: goodScriptRan, expected: true },
                { name: 'Bad script content should be removed from DOM', result: badScriptTextRemoved, expected: true },
                { name: 'Good script content should remain in DOM', result: goodScriptTextRemains, expected: true }
            ];
        });

        // eslint-disable-next-line no-undef
        renderResults();
    </script>
</body>
</html> 