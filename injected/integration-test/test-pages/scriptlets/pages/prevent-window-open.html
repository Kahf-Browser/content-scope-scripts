<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Prevent Window Open Scriptlet Test</title>
    <link rel="stylesheet" href="../../shared/style.css">
</head>
<body>
    <script src="../../shared/utils.js"></script>
    <p><a href="../index.html">[Scriptlets]</a></p>

    <p>This page verifies that the prevent-window-open scriptlet works properly given the <a href="../config/prevent-window-open.json">config</a>.</p>

    <script>
        // eslint-disable-next-line no-undef
        test('Prevent-window-open scriptlet should block window.open calls', async () => {
            // Wait a bit for scriptlets to execute
            await new Promise(resolve => setTimeout(resolve, 100));
            
            let windowOpenCalled = false;
            let windowOpenResult = null;
            
            // Try to call window.open
            try {
                windowOpenResult = window.open('about:blank', '_blank');
                windowOpenCalled = true;
            } catch (error) {
                // If an error is thrown, that's also a way to block
                windowOpenCalled = false;
            }

            // Check if window.open was effectively blocked
            const wasBlocked = !windowOpenResult || windowOpenResult === null || windowOpenResult === undefined;
            
            // Close the window if it was opened
            if (windowOpenResult && typeof windowOpenResult.close === 'function') {
                windowOpenResult.close();
            }

            return [
                { name: 'window.open should be blocked or return null', result: wasBlocked, expected: true },
                { name: 'window.open function should still exist', result: typeof window.open, expected: 'function' }
            ];
        });

        // eslint-disable-next-line no-undef
        renderResults();
    </script>
</body>
</html> 